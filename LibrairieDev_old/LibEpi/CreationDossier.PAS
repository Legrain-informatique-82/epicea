Unit CreationDossier;
{ Generated by OD TB CREATOR (c) 1997-99 O.DAHAN odahan@cybercable.fr
  On 16/05/2002 16:29:59 }

interface

//CREATE TABLE "autorisation.db" (id_autorisation AUTOINC,fichier Blob,date_der_synchro timestamp,quand_cree timestamp,quand_modif timestamp,
//qui_cree varchar(50),qui_modif varchar(50),PRIMARY KEY(id_autorisation))

uses SysUtils,Windows, Classes, Graphics, Forms, Controls,
     StdCtrls, DBTables, DB, ExtCtrls, Dialogs,
      BDE ,
     LibSql,
     dbiTypes, dbiProcs,
     E2_Decl_Records,
     E2_Librairie_Obj;


 type
TChangeRec = packed record
szName: DBINAME;
iType: word;
iSubType: word;
iLength: word;
iPrecision: byte;
end;

procedure CreateTables(DBALIAS0 : String);
procedure UpdateTables(DBALIAS0 : String);
// Callbacks
Type TPseudoEvent = Procedure(T:Ttable;TableNum:Integer;var WantAbort:Boolean);

Var  BeforeCreateCB,
     AfterCreateCB,
     ProgressCB : TPseudoEvent;
       ChangeRec: TChangeRec;
Const
//DBALIAS0 : String =  'Demo';


// how much tables to create
TABLECOUNT = 26;

implementation
uses DMCorrection, DiversProjets;

// dummy callback
var wantabort:boolean;
Procedure DummyCallback(T:TTable;TableNum:Integer;var WantAbort:Boolean);
Begin
//Showmessage('Attention, la table'+Inttostr(TableNum)+ ' est manquante');
wantAbort:=false;
{nothing}
end;



function GetFieldInfo(const aPath, aTablename, aFieldName: string;
var FieldType: TFieldType; var FieldSize: Word): boolean;
var aTable: TTable;
i: Integer;
begin
Result:=False; // field not found
FieldType := ftUnknown;
FieldSize := 0;
aTable:=TTable.Create(nil);
try
aTable.DatabaseName := aPath;
aTable.TableName:=aTableName;
aTable.FieldDefs.Update;
i:=aTable.FieldDefs.IndexOf(aFieldName);
if i<>-1 then begin
Result:=True; // field found
FieldType:=aTable.FieldDefs.Items[i].DataType;
FieldSize:=aTable.FieldDefs.Items[i].Size;
end;
finally
aTable.Free;
end;
end;

function GetFieldSize(const aPath, aTablename, aFieldName: string): Word;
var FieldType: TFieldType;
begin
GetFieldInfo(aPath, ATableName, aFieldName, FieldType, Result);
end;

function GetFieldType(const aPath, aTablename, aFieldName: string):
TFieldType;
var FieldSize: word;
begin
GetFieldInfo(aPath, ATableName, aFieldName, Result, FieldSize);
end;

procedure ChangeField(aPath, aTablename, aFieldName: string; Rec:
TChangeRec);
var
Props: CURProps;
hDb: hDBIDb;
TableDesc: CRTblDesc;
pFields: pFLDDesc;
pOp: pCROpType;
B: byte;
aTable : TTable;
aField :TField;
s: string;

begin
aTableName:=IncludeTrailingPathDelimiter(aPath) + aTableName;
aTable:=TTable.Create(nil);
aTable.TableName:=aTableName;
aTable.Exclusive:=True; {Set Exclusive open}
aTable.Open;
aField:=aTable.FieldbyName(aFieldName);

{// Initialize the pointers...}
//pFields := nil; pOp := nil;
Check(DbiSetProp(hDBIObj(aTable.Handle), curxltMODE, integer(xltNONE)));
{// Get the table properties to determine table type...}
Check(DbiGetCursorProps(aTable.Handle, Props));
{// Make sure the table is either Paradox or dBASE...}

{// Allocate memory for the field descriptor...}
pFields := AllocMem(aTable.FieldCount * sizeof(FLDDesc));
{// Allocate memory for the operation descriptor...}
pOp := AllocMem(aTable.FieldCount * sizeof(CROpType));
try
{// Set the pointer to the index in the operation descriptor to put
// crMODIFY (This means a modification to the record is going to
happen)...}
Inc(pOp, aField.Index);
{Inc(pOp, Field.Index);}
pOp^ := crMODIFY;
Dec(pOp, aField.Index);
{Dec(pOp, Field.Index);}
{// Fill the field descriptor with the existing field information...}
Check(DbiGetFieldDescs(aTable.Handle, pFields));
{// Set the pointer to the index in the field descriptor to make the
// midifications to the field}
Inc(pFields, aField.Index);
{Inc(pFields, Field.Index);}

{// If the szName portion of the ChangeRec has something in it,
change it...}
{if Length(Rec.szName) > 0 then}{Erroneus, original BORLAND line}
if StrLen(Rec.szName) > 0 then {Mne 7.5.98}
pFields^.szName := Rec.szName;
{// If the iType portion of the ChangeRec has something in it,
change it...}
if Rec.iType > 0 then
pFields^.iFldType := Rec.iType;
{// If the iSubType portion of the ChangeRec has something in it,
change it...}
if Rec.iSubType > 0 then
pFields^.iSubType := Rec.iSubType;
{// If the iLength portion of the ChangeRec has something in it,
change it...}
if Rec.iLength > 0 then
pFields^.iUnits1 := Rec.iLength;
{// If the iPrecision portion of the ChangeRec has something in it,
change it...}
if Rec.iPrecision > 0 then
pFields^.iUnits2 := Rec.iPrecision;
Dec(pFields, aField.Index);
{Dec(pFields, Field.Index);}

for B := 1 to aTable.FieldCount do begin
pFields^.iFldNum := B;
Inc(pFields, 1);
end;
Dec(pFields, aTable.FieldCount);

{// Blank out the structure...}
FillChar(TableDesc, sizeof(TableDesc), 0);
{// Get the database handle from the table's cursor handle...}
Check(DbiGetObjFromObj(hDBIObj(aTable.Handle), objDATABASE,
hDBIObj(hDb)));
{// Put the table name in the table descriptor...}
StrPCopy(TableDesc.szTblName, aTable.TableName);
{// Put the table type in the table descriptor...}
StrPCopy(TableDesc.szTblType, Props.szTableType);

{// The following three lines are necessary when doing any field
restructure operations on a table...}
{// Set the field count for the table}
TableDesc.iFldCount := aTable.FieldCount;
{// Link the operation descriptor to the table descriptor...}
TableDesc.pecrFldOp := pOp;
{// Link the field descriptor to the table descriptor...}
TableDesc.pFldDesc := pFields;
{// Close the table so the restructure can complete...}
aTable.Close;

// transform the name from Ansi to in Ascii char
s:=aTableName;
CharToOem(PChar(s), PChar(s)); // DbiDoRestrucure need a Ascii name, not an ansi name !
StrPCopy(TableDesc.szTblName, s);

{// Call DbiDoRestructure...}
Check(DbiDoRestructure(hDb, 1, @TableDesc, nil, nil, nil, FALSE));
finally

if pFields <> nil then
FreeMem(pFields, aTable.FieldCount * sizeof(FLDDesc));
if pOp <> nil then
FreeMem(pOp, aTable.FieldCount * sizeof(CROpType));
aTable.Free;
end;
end;


function ChangeFieldLength(const DPath, aTable, aField: string;
OldLength, NewLength: Integer): boolean;
{ Procedure to change one Field Length }
var aChangeRec: TChangeRec;
begin
Result:=False;
if GetFieldSize(Dpath, aTable, aField) = OldLength then begin
Fillchar(aChangeRec, sizeof(aChangeRec), 0); {Fill rec with zeros}
aChangeRec.iLength:=NewLength;
ChangeField(Dpath, aTable, aField, aChangeRec);
Result:=True;
end;
end;

procedure AddField(Table: TTable; NewField: TChangeRec);
var
  Props: CURProps;
  hDb: hDBIDb;
  TableDesc: CRTblDesc;
  pFlds: pFLDDesc;
  pOp: pCROpType;
  B: byte;

begin
  // Make sure the table is open exclusively so we can get the db handle...
  if Table.Active = False then
    raise EDatabaseError.Create('Table must be opened to restructure');
  if Table.Exclusive = False then
    raise EDatabaseError.Create('Table must be opened exclusively to restructure');

  // Get the table properties to determine table type...
  Check(DbiSetProp(hDBIObj(Table.Handle), curxltMODE, integer(xltNONE)));
  Check(DbiGetCursorProps(Table.Handle, Props));
  pFlds := AllocMem((Table.FieldCount + 1) * sizeof(FLDDesc));
  FillChar(pFlds^, (Table.FieldCount + 1) * sizeof(FLDDesc), 0);
  Check(DbiGetFieldDescs(Table.handle, pFlds));

  for B := 1 to Table.FieldCount do begin
    pFlds^.iFldNum := B;
    Inc(pFlds, 1);
  end;
  try
    StrCopy(pFlds^.szName, NewField.szName);
    pFlds^.iFldType := NewField.iType;
    pFlds^.iSubType := NewField.iSubType;
    pFlds^.iUnits1  := NewField.iLength;
    pFlds^.iUnits2  := NewField.iPrecision;
    pFlds^.iFldNum  := Table.FieldCount + 1;
  finally
    Dec(pFlds, Table.FieldCount);
  end;

  pOp := AllocMem((Table.FieldCount + 1) * sizeof(CROpType));
  Inc(pOp, Table.FieldCount);
  pOp^ := crADD;
  Dec(pOp, Table.FieldCount);

  // Blank out the structure...
  FillChar(TableDesc, sizeof(TableDesc), 0);
  //  Get the database handle from the table's cursor handle...
  Check(DbiGetObjFromObj(hDBIObj(Table.Handle), objDATABASE, hDBIObj(hDb)));
  // Put the table name in the table descriptor...
  StrPCopy(TableDesc.szTblName, Table.TableName);
  // Put the table type in the table descriptor...
  StrPCopy(TableDesc.szTblType, Props.szTableType);
  // Close the table so the restructure can complete...
  TableDesc.iFldCount := Table.FieldCount + 1;
  Tabledesc.pfldDesc := pFlds;
  TableDesc.pecrFldOp := pOp;
  Table.Close;
  // Call DbiDoRestructure...
  try
    Check(DbiDoRestructure(hDb, 1, @TableDesc, nil, nil, nil, FALSE));
  finally
    FreeMem(pFlds);
    FreeMem(pOp);
    Table.Open;
  end;
end;

function ChangeFieldType(const DPath, aTable, aField: string;
OldFieldType, NewFieldType: TFieldType; NewLength: integer = 0): boolean;
{ Procedure to change one Field type. }
var aChangeRec: TChangeRec;
begin
Result:=False;
if GetFieldType(Dpath, aTable, aField) = OldFieldType then begin
Fillchar(aChangeRec, sizeof(aChangeRec), 0); {Fill rec with zeros}
aChangeRec.iType := FldTypeMap[NewFieldType];
aChangeRec.iSubType := FldSubTypeMap[NewFieldType];
aChangeRec.iLength:=NewLength;
ChangeField(Dpath, aTable, aField, aChangeRec);
Result:=True;
end;
end;

function ChangeFieldName(const DPath, aTable, aField, NewFieldName:
string): boolean;
{ Procedure to change one field name. }
var aChangeRec: TChangeRec;
begin
Result:=False;
if NewFieldName='' then Exit;
Fillchar(aChangeRec, sizeof(aChangeRec), 0); {Fill rec with zeros}
Move(NewFieldName[1], aChangeRec.szName, Length(NewFieldName)+1); //+ 1 to have the terminal zero
ChangeField(Dpath, aTable, aField, aChangeRec);
Result:=True;
end;


procedure CreateTables(DBALIAS0 : String);
var
  table: TTable;
  Query:TQuery; //alter table H_TVA
                        //add MontantTVA VarCurrency(8,2);
  TblExists: Boolean;
  IndexExiste: Boolean;   // ,creationUtilisateur,ForceCreation
  I:integer;
  Label
TABLEno0, TABLEno1, TABLEno2, TABLEno3, TABLEno4,
TABLEno5, TABLEno6, TABLEno7, TABLEno8, TABLEno9,
TABLEno10, TABLEno11, TABLEno12, TABLEno13, TABLEno14,
TABLEno15, TABLEno16, TABLEno17, TABLEno18, TABLEno19,
TABLEno20, TABLEno21, TABLEno22, TABLEno23, TABLEno24,
TABLEno25, TABLEno26, TABLEno27, TABLEno28,TABLEno29,
TABLEno30,TABLEno31,TABLEno32,TABLEno33,TABLEno34,TABLEno35,TABLEno36,TABLEno37,TABLEno38,TABLEno39,LBLEND,

TABLEno0b, TABLEno1b, TABLEno2b, TABLEno3b, TABLEno4b,
TABLEno5b, TABLEno6b, TABLEno7b, TABLEno8b, TABLEno9b,
TABLEno10b,  TABLEno11b, TABLEno12b, TABLEno13b, TABLEno14b,
TABLEno15b, TABLEno16b, TABLEno17b, TABLEno18b, TABLEno19b,
TABLEno20b, TABLEno21b, TABLEno22b, TABLEno23b,  TABLEno24b,
TABLEno25b, TABLEno26b, TABLEno27b,TABLEno28b,TABLEno29b,
TABLEno30b,TABLEno31b,TABLEno32b,TABLEno33b,TABLEno34b,TABLEno35b,TABLEno36b,TABLEno37b,TABLEno38b,TABLEno39b,TABLEno40b,LBLENDb;
begin
Screen.Cursor := crHourGlass;
//creationUtilisateur:=false;
//ForceCreation:=false;
Try
  table := TTable.Create(Application);
///
  Query:=TQuery.Create(Application);
  Query.DatabaseName :=DBALIAS0;
///
  Try
  with table do
  begin

    { Creating : DBALIAS0 --> Dec_Tva.db }
    TABLEno0: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Dec_Tva.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
       try
        if FindField('Divers') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table Dec_Tva ');
            Query.SQL.Add(' add Divers VarChar(100)');
            Query.Open;
           end;
       except
       end;
     end;
 active:=false;
 if TblExists then goto TABLEno1b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Piece', ftInteger, 0, False);
      Add('ID_Ligne', ftInteger, 0, False);
      Add('TvaCode', ftString, 2, False);
      Add('TvaType', ftString, 1, False);
      Add('TvaDate', ftDateTime, 0, False);
      Add('TvaMontantDebit', ftCurrency, 0, False);
      Add('TvaMontantCredit', ftCurrency, 0, False);
      Add('En_Attente', ftBoolean, 0, False);
      Add('Part_Declaration', ftFloat, 0, False);
      Add('Divers', ftString, 100, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID;ID_Piece;ID_Ligne', [ixPrimary, ixUnique]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 1, WantAbort);
    If WantAbort then Goto TABLEno1;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Dec_Tva.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 1, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 1, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Det_Cre.DB }
    TABLEno1b:
    TABLEno1: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Det_Cre.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno2b;

    with FieldDefs do
    begin
      Clear;
      Add('ID_Ecriture', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Creance', ftBoolean, 0, False);
      Add('Montant', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID_Ecriture', [ixPrimary, ixUnique]);
      Add('Compte_', 'Compte;Creance', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False; 
    BeforeCreateCB(Table, 2, WantAbort);
    If WantAbort then Goto TABLEno2;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Det_Cre.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 2, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 2, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Echeance.db }
    TABLEno2b:
    TABLEno2: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Echeance.db';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno3b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftAutoInc, 0, False);
      Add('ID_Ecriture', ftInteger, 0, False);
      Add('Date', ftDate, 0, False);
      Add('Creance', ftBoolean, 0, False);
      Add('SaiseMontant', ftBoolean, 0, False);
      Add('PourCent', ftFloat, 0, False);
      Add('Montant', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 3, WantAbort);
    If WantAbort then Goto TABLEno3;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Echeance.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 3, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 3, WantAbort);
    If WantAbort then Goto LBLEND;


// CREATE INDEX DateEch_ ON "EchEmp.db" (id_emp,Date)

    { Creating : DBALIAS0 --> EchEmp.DB }
    TABLEno3b:
    TABLEno3: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'EchEmp.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
       try
          IndexDefs.Clear;
          active:=false;
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX DateEch_ ');
          Query.SQL.Add(' ON "EchEmp.db" (id_emp,EchEmp."Date")');
          Query.ExecSQL;
          IndexDefs.Update;
       except
       end;
     end;
    active:=false;
    if TblExists then goto TABLEno4b;
    with FieldDefs do
    begin
      Clear;
      Add('Id_Annuite', ftInteger, 0, False);
      Add('Id_Emp', ftInteger, 0, False);
      Add('Date', ftDate, 0, False);
      Add('Annuite', ftCurrency, 0, False);
      Add('Capital', ftCurrency, 0, False);
      Add('Interets', ftCurrency, 0, False);
      Add('Assurances', ftCurrency, 0, False);
      Add('Frais_Divers', ftCurrency, 0, False);
      Add('Capital_Restant_du', ftCurrency, 0, False);
      Add('Rembourse', ftBoolean, 0, False);
      Add('Annule', ftBoolean, 0, False);
      Add('DateRemboursement', ftDate, 0, False);
      Add('Reference', ftString, 9, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id_Annuite', [ixPrimary, ixUnique]);
      Add('IdEmp', 'Id_Emp', [ixCaseInsensitive]);
      Add('DateEch_','id_emp;Date', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 4, WantAbort);
    If WantAbort then Goto TABLEno4;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: EchEmp.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 4, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 4, WantAbort);
    If WantAbort then Goto LBLEND;





    { Creating : DBALIAS0 --> Ecriture.DB }
    TABLEno4b:
    TABLEno4: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Ecriture.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
          IndexDefs.Clear;   //IndexEcriture', 'compte;id'
        try
        if FieldDefs.IndexOf('MarqueReleve') <> -1 then
           begin
            active:=false;
            ChangeFieldLength(DataBaseName,'ecriture.db','MarqueReleve',13,8);
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('MarqueReleve') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='MarqueReleve';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=8;
            AddField(table,ChangeRec);
//            Query.Close;
//            Query.SQL.Clear;
//            Query.SQL.Add(' alter table Ecriture ');
//            Query.SQL.Add(' MarqueReleve VarChar(8)');
//            Query.Open;
           end;
         except
         end;
        try
       active:=false;

//
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX IndexEcriture ');
          Query.SQL.Add(' ON "Ecriture.db" (compte,id)');
          Query.ExecSQL;
//
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX DateCompteTiers_ ');
          Query.SQL.Add(' ON "Ecriture.db" (Compte,Ecriture."Date",Tiers)');
          Query.ExecSQL;
//
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX DateCompte_ ');
          Query.SQL.Add(' ON "Ecriture.db" (Compte,Ecriture."Date")');
          Query.ExecSQL;

          Query.Close;
          Query.SQL.Clear;                   
          Query.SQL.Add(' CREATE INDEX Piece_ ');
          Query.SQL.Add(' ON "Ecriture.db" (ID_Piece,TypeLigne,ID_Ligne)');
          Query.ExecSQL;

          IndexDefs.Update;
       except
       end;
     end;
    active:=false;
    if TblExists then goto TABLEno5b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Piece', ftInteger, 0, False);
      Add('TypeLigne', ftString, 1, False);
      Add('ID_Ligne', ftSmallInt, 0, False);
      Add('Date', ftDate, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Tiers', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Qt1', ftFloat, 0, False);
      Add('Qt2', ftFloat, 0, False);
      Add('DebitSaisie', ftCurrency, 0, False);
      Add('CreditSaisie', ftCurrency, 0, False);
      Add('ID_Devise', ftInteger, 0, False);
      Add('Debit', ftCurrency, 0, False);
      Add('Credit', ftCurrency, 0, False);
      Add('TvaCode', ftString, 2, False);
      Add('TvaType', ftString, 1, False);
      Add('TvaTaux', ftFloat, 0, False);
      Add('TvaDate', ftDate, 0, False);
      Add('Rapprochement', ftString, 8, False);
      Add('Validation', ftDate, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('Num_Cheque', ftString, 50, False);
      Add('Table_Gen', ftString, 50, False);
      Add('Champ_Gen', ftString, 50, False);
      Add('Val_Champ_Gen', ftString, 100, False);
      Add('ID_GESTCO', ftFloat, 0, False);
      Add('CODE_GESTCO', ftString, 50, False);
      Add('Montant_Tva', ftCurrency, 0, False);
      Add('ID_GESTANAL',ftInteger, 0, False);
      Add('CODE_GESTANAL',ftString, 50, False);
      Add('MarqueReleve', ftString, 8, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Piece_', 'ID_Piece;TypeLigne;ID_Ligne', [ixCaseInsensitive]);
      Add('Compte_', 'Compte;Tiers;Date', [ixCaseInsensitive]);
      Add('Tiers_', 'Tiers;Date', [ixCaseInsensitive]);
      Add('IDLigne', 'ID_Ligne', [ixCaseInsensitive]);
      Add('ID_Piece', 'ID_Piece', []);
      add('IndexEcriture','compte;id',[ixCaseInsensitive]);
      add('DateCompte_','Compte;Date',[]);
      add('DateCompteTiers_','Compte;Date;Tiers',[]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False; 
    BeforeCreateCB(Table, 5, WantAbort);
    If WantAbort then Goto TABLEno5;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Ecriture.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 5, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 5, WantAbort);
    If WantAbort then Goto LBLEND;



    { Creating : DBALIAS0 --> H_TVA.db }
    TABLEno5b:
    TABLEno5: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'H_TVA.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
       try
//  showmessage('InitH_TVA_MontantTVA');
        if FindField('MontantTVA') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table H_TVA ');
            Query.SQL.Add(' add MontantTVA Money');
            Query.Open;
           end;
       except
       end;
       try
        open;
//  showmessage('InitH_TVA_HTDeclare');
        if FindField('HTDeclare') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table H_TVA ');
            Query.SQL.Add(' add HTDeclare Money');
            Query.Open;
           end;
       except
       end;
       try
        open;
//  showmessage('InitH_TVA_Divers');
        if FindField('Divers') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table H_TVA ');
            Query.SQL.Add(' add Divers VarChar(100)');
            Query.Open;
           end;
       except
       end;
       try
        open;
        if FindField('CodeCompensation') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table H_TVA ');
            Query.SQL.Add(' add CodeCompensation VarChar(2)');
            Query.Open;
           end;
       except
       end;
       try
        open;
//  showmessage('InitH_TVA_HTDeclare');
        if FindField('Taux') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table H_TVA ');
            Query.SQL.Add(' add Taux FLOAT');
            Query.Open;
           end;
       except
       end;
     end;
 active:=false;
    if TblExists then goto TABLEno6b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Ecriture', ftInteger, 0, False);
      Add('ID_Piece', ftInteger, 0, False);
      Add('ID_Declaration', ftInteger, 0, False);
      Add('Part_Declaree', ftFloat, 0, False);
      Add('Debut_Periode', ftDatetime, 0, False);
      Add('Fin_Periode', ftDatetime, 0, False);
      Add('Verrouillee', ftBoolean, 0, False);
      Add('Deverrouillable', ftBoolean, 0, False);
      Add('En_Attente', ftBoolean, 0, False);
      Add('Date_Tva', ftDatetime, 0, False);
      Add('Reference_OD', ftString, 9, False);
      Add('MontantTVA', ftCurrency, 0, False);
      Add('HTDeclare', ftCurrency, 0, False);
      Add('Divers', ftString, 100, False);
      Add('CodeCompensation', ftString, 2, False);
      Add('Taux',ftFloat,0,False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 6, WantAbort);
    If WantAbort then Goto TABLEno6;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: H_TVA.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 6, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 6, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Immos.DB }
    TABLEno6b:
    TABLEno6: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Immos.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
       try
        if FindField('SousCodeTerminee') = nil then
           begin
            active:=false;
            Query.Close;
            Query.SQL.Clear;
            Query.SQL.Add(' alter table Immos ');
            Query.SQL.Add(' add SousCodeTerminee VarChar(1)');
            Query.Open;
           end;
       except
       end;
     end;
    active:=false;
    if TblExists then goto TABLEno7b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Libelle', ftString, 100, False);
      Add('Ecriture_Achat', ftInteger, 0, False);
      Add('Ecriture_Cession', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Code', ftString, 3, False);
      Add('Sous_Code', ftString, 1, False);
      Add('Date_Org', ftDate, 0, False);
      Add('Valeur_Org', ftCurrency, 0, False);
      Add('Valeur_Venale', ftCurrency, 0, False);
      Add('Duree', ftSmallInt, 0, False);
      Add('Valeur_a_Amortir', ftCurrency, 0, False);
      Add('Date_Achat', ftDate, 0, False);
      Add('Date_Mise_en_Service', ftDate, 0, False);
      Add('Duree_Amt', ftSmallInt, 0, False);
      Add('Type_Amt', ftString, 1, False);
      Add('Deduc_Invest', ftBoolean, 0, False);
      Add('Mt_Deduc_Invest', ftCurrency, 0, False);
      Add('Reprise_deduc_invest', ftCurrency, 0, False);
      Add('Valeur_Nette', ftCurrency, 0, False);
      Add('Amort_Eco', ftCurrency, 0, False);
      Add('Amort_Derog', ftCurrency, 0, False);
      Add('Mt_Cession', ftCurrency, 0, False);
      Add('Date_Cession', ftDate, 0, False);
      Add('Rebut', ftBoolean, 0, False);
      Add('Achat_dans_Annee', ftBoolean, 0, False);
      Add('Cession_dans_Annee', ftBoolean, 0, False);
      Add('Duree_Restante', ftSmallInt, 0, False);
      Add('Simulation', ftString, 1, False);
      Add('Sous_Compte', ftBoolean, 0, False);
      Add('Maxi', ftCurrency, 0, False);
      Add('Mini', ftCurrency, 0, False);
      Add('Choix', ftCurrency, 0, False);
      Add('Eco', ftCurrency, 0, False);
      Add('Terminee', ftBoolean, 0, False);
      Add('EnCours', ftBoolean, 0, False);
      Add('CodeTerminee', ftString, 3, False);
      Add('CompteTerminee', ftString, 8, False);
      Add('SousCodeTerminee', ftString, 1, False);
      Add('TauxAmo', ftFloat, 0, False);
      Add('Tiers', ftString, 8, False);
      Add('ReferenceFacture', ftString, 8, False);
      Add('MontantTTC', ftCurrency, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('idxLibelle', 'Libelle', [ixCaseInsensitive]);
      Add('idxCompte', 'Compte;Code;Sous_Code', [ixUnique, ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 7, WantAbort);
    If WantAbort then Goto TABLEno7;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Immos.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 7, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 7, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Model.DB }
    TABLEno7b:
    TABLEno7: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Model.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno8b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Code', ftString, 10, False);
      Add('Libelle_Model', ftString, 100, False);
      Add('Libelle', ftString, 100, False);
      Add('Journal', ftString, 2, False);
      Add('Compte', ftString, 8, False);
      Add('Compte_Reglement', ftString, 8, False);
      Add('Minimun', ftBoolean, 0, False);
      Add('ID_Devise', ftInteger, 0, False);
      Add('ID_Journal', ftInteger, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('CODE_BANQUE_GESTCO', ftString, 50, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Code_', 'Code', [ixCaseInsensitive]);
      Add('Libelle_', 'Libelle_Model', [ixCaseInsensitive]);
      Add('Compte_', 'ID_Journal;Compte', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 8, WantAbort);
    If WantAbort then Goto TABLEno8;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Model.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 8, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 8, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> ModelL.DB }
    TABLEno8b:
    TABLEno8: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'ModelL.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno9b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Model', ftInteger, 0, False);
      Add('Ligne', ftSmallInt, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Qt1', ftFloat, 0, False);
      Add('Qt2', ftFloat, 0, False);
      Add('Montant', ftCurrency, 0, False);
      Add('Tva', ftCurrency, 0, False);
      Add('TvaCode', ftString, 2, False);
      Add('TvaType', ftString, 1, False);
      Add('TvaTaux', ftFloat, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 9, WantAbort);
    If WantAbort then Goto TABLEno9;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: ModelL.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 9, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 9, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Param_Dossier.DB }
    TABLEno9b:
    TABLEno9: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Param_Dossier.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then BEGIN
    try
        if FieldDefs.IndexOf('CREATION') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='CREATION';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=25;
            AddField(table,ChangeRec);
////            ForceCreation:=true;
//            if(e.TypeUtilisateur in [U_Normal,U_SuperComptable,U_LibreService])then
//              begin
//                  active:=false;
//                  exclusive:=false;
//                  active:=true;
//                  TableGereEdit(table);
//                  table.FindField(ChangeRec.szName).AsString:=typeUtilisateurtoStr(e.TypeUtilisateur);
//                  tablegerepost(table);
//              end;
           end;
        if FieldDefs.IndexOf('MODIFICATION') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='MODIFICATION';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=25;
            AddField(table,ChangeRec);
           end;
        if FieldDefs.IndexOf('FORCE') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='FORCE';
            ChangeRec.iType:=fldBOOL;
            ChangeRec.iLength:=0;
            AddField(table,ChangeRec);
//            if(e.TypeUtilisateur in [U_Normal,U_SuperComptable,U_LibreService])then
//              begin
//                  active:=false;
//                  exclusive:=false;
//                  active:=true;
//                  TableGereEdit(table);
//                  table.FindField(ChangeRec.szName).AsBoolean:=true;
//                  tablegerepost(table);
//              end;
           end;
    except
    active:=false;
    end;
    END;

    active:=false;
    if TblExists then goto TABLEno10b;
    with FieldDefs do
    begin
      Clear;
      Add('CLE', ftString, 5, False);
      Add('NOM_DOSS', ftString, 30, False);
      Add('Adr1', ftString, 30, False);
      Add('Adr2', ftString, 30, False);
      Add('CP', ftString, 10, False);
      Add('VILLE', ftString, 30, False);
      Add('REGIME_Agr', ftString, 1, False);
      Add('TYPE_SOC', ftString, 3, False);
      Add('TYPE_FISC', ftString, 3, False);
      Add('PERIODE_TVA', ftString, 1, False);
      Add('TVA_DEBIT', ftString, 1, False);
      Add('PLAN_AUX', ftString, 1, False);
      Add('PERIODE', ftString, 1, False);
      Add('TYPE_IMPOT', ftString, 1, False);
      Add('TYPE_DEC_FISC', ftString, 1, False);
      Add('DATE_DEB_EXO', ftDate, 0, False);
      Add('DATE_FIN_EXO', ftDate, 0, False);
      Add('EXO_SAISIE', ftString, 2, False);
      Add('EXO_BASE', ftString, 2, False);
      Add('DEVISE_EXO', ftString, 3, False);
      Add('DIV', ftBlob, 240, False);
      Add('DATE_PREM_DECL_TVA', ftDatetime, 0, False);
      Add('DEROGATOIRE', ftBoolean, 0, False);
      Add('DATE_PASSAGE_REEL', ftDatetime, 0, False);
      Add('AU_REEL', ftBoolean, 0, False);
      Add('PARAM_DIV', ftString, 255, False);
      Add('UTILISATEUR', ftString, 255, False);
      Add('CREATION', ftString, 25, False);
      Add('MODIFICATION', ftString, 25, False);
      Add('FORCE', ftBoolean, 0, False);

    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 10, WantAbort);
    If WantAbort then Goto TABLEno10;

    Try If not TblExists then
    begin
      CreateTable;
//      creationUtilisateur:=true;
    end;
    Except ShowMessage('Impossible de créer la table: Param_Dossier.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 10, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 10, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Piece.DB }
    TABLEno10b:
    TABLEno10: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Piece.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table

    if TblExists then
     begin
       try
          active:=false;

          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' select * from piece ');
          Query.open;

          if query.FindField('Echeance')=nil then
            begin
                Query.Close;
                Query.SQL.Clear;
                Query.SQL.Add(' Alter table piece add Echeance date ');
                Query.ExecSQL;
            end;
       except
       end;
                Query.Close;
                Query.SQL.Clear;
                Query.SQL.Add(' update piece P set Echeance = P."Date" where Echeance is null ');
                Query.ExecSQL;
     end;

    active:=false;
    if TblExists then goto TABLEno11b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Journal', ftInteger, 0, False);
      Add('Reference', ftString, 9, False);
      Add('Date', ftDate, 0, False);
      Add('Libelle', ftString, 100, False);
      Add('TypePiece', ftSmallInt, 0, False);
      Add('Compte', ftString, 8, False);
      Add('ID_Devise', ftInteger, 0, False);
      Add('Validation', ftDate, 0, False);
      Add('Echeance', ftDate, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('Num_Cheque', ftString, 50, False);
      Add('ID_GESTCO', ftFloat, 0, False);
      Add('CODE_GESTCO', ftString, 50, False);
      Add('Table_Gen', ftString, 50, False);
      Add('Champ_Gen', ftString, 50, False);
      Add('Val_Champ_Gen', ftString, 100, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Reference_', 'Reference', [ixCaseInsensitive]);
      Add('Date_', 'Date', [ixCaseInsensitive]);
      Add('TypePiece_', 'TypePiece;Date', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 11, WantAbort);
    If WantAbort then Goto TABLEno11;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Piece.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 11, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 11, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> plancpt.DB }
    TABLEno11b:
    TABLEno11: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'plancpt.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno12b;
    with FieldDefs do
    begin
      Clear;
      FieldDefs.Add('Compte', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Debit_Deb', ftFloat, 0, False);
      Add('Credit_Deb', ftFloat, 0, False);
      Add('Un1', ftString, 2, False);
      Add('Un2', ftString, 2, False);
      Add('Qt1_Deb', ftFloat, 0, False);
      Add('Qt2_Deb', ftFloat, 0, False);
      Add('PlanSaisie', ftBoolean, 0, False);
      Add('TvaCode', ftString, 2, False);
      Add('TvaType', ftString, 1, False);
      Add('TvaDebit', ftBoolean, 0, False);
      Add('SensCredit', ftBoolean, 0, False);
      Add('Collectif', ftBoolean, 0, False);
      Add('Centraliser', ftBoolean, 0, False);
      Add('Tiers', ftBoolean, 0, False);
      Add('Rapprochement', ftBoolean, 0, False);
      Add('Immobilisation', ftBoolean, 0, False);
      Add('ImmoAmort', ftBoolean, 0, False);
      Add('ImmoDegressif', ftBoolean, 0, False);
      Add('Emprunt', ftBoolean, 0, False);
      Add('Abandonne', ftBoolean, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('ID_Affichage', ftInteger, 0, False);
      Add('JBanque', ftString, 15, False);
      Add('pointable', ftBoolean, 0, False);
      Add('taux', ftFloat, 0, False);
      Add('DIV', ftString, 255, False);
      Add('ID_GESTANAL',ftInteger, 0, False);
      Add('CODE_GESTANAL',ftString, 50, False);
      Add('UtilOuvAuto', ftBoolean, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Compte', [ixPrimary, ixUnique]);
      Add('CPT_', 'Compte', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 12, WantAbort);
    If WantAbort then Goto TABLEno12;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: plancpt.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 12, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 12, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Pointage.DB }
    TABLEno12b:
    TABLEno12: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Pointage.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno13b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftFloat, 0, False);
      Add('ID_Debit', ftInteger, 0, False);
      Add('ID_Credit', ftInteger, 0, False);
      Add('Date', ftDate, 0, False);
      Add('Montant', ftCurrency, 0, False);
      Add('TvaDate', ftDate, 0, False);
      Add('Validation', ftDate, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Debit_', 'ID_Debit;Date', [ixCaseInsensitive]);
      Add('Credit_', 'ID_Credit;Date', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 13, WantAbort);
    If WantAbort then Goto TABLEno13;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Pointage.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 13, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 13, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> ResteDC.DB }
    TABLEno13b:
    TABLEno13: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'ResteDC.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
     begin
       try
          IndexDefs.Clear;   //
          active:=false;
//
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX DateSeule ');
          Query.SQL.Add(' ON "ResteDC.db" (ResteDC."Date")');
          Query.ExecSQL;
//
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX ResteSeule ');
          Query.SQL.Add(' ON "ResteDC.db" (Reste)');
          Query.ExecSQL;
//
//
          IndexDefs.Update;
       except
       end;
     end;
    active:=false;
    if TblExists then goto TABLEno14b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Ecriture', ftInteger, 0, False);
      Add('ID_Piece', ftInteger, 0, False);
      Add('Date', ftDate, 0, False);
      Add('Reference', ftString, 9, False);
      Add('Tiers', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Debit', ftCurrency, 0, False);
      Add('Credit', ftCurrency, 0, False);
      Add('Sens', ftString, 1, False);
      Add('Reste', ftCurrency, 0, False);
      Add('Lettre', ftString, 1, False);
      Add('Montant', ftCurrency, 0, False);
      Add('Ligne', ftInteger, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Reste_', 'Tiers;Reste;Date;Reference', [ixCaseInsensitive]);
      Add('Lettre_', 'Tiers;Sens;Lettre;Date;Reference', []);
      Add('ID_', 'ID_Ecriture', [ixCaseInsensitive]);
      Add('Date_', 'Tiers;Date;Reference', [ixCaseInsensitive]);
      Add('DateSeule','Date',[ixCaseInsensitive]);
      Add('ResteSeule','Reste',[ixCaseInsensitive]);
      Add('IDPiece_', 'ID_Piece', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 14, WantAbort);
    If WantAbort then Goto TABLEno14;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: ResteDC.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 14, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 14, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Tiers.DB }
    TABLEno14b:
    TABLEno14: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Tiers.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno15b;
    with FieldDefs do
    begin
      Clear;
      Add('Tiers', ftString, 8, False);
      Add('Nom', ftString, 100, False);
      Add('Compte', ftString, 8, False);
      Add('Type', ftString, 1, False);
      Add('SensCredit', ftBoolean, 0, False);
      Add('Rapprochement', ftBoolean, 0, False);
      Add('TvaDebit', ftBoolean, 0, False);
      Add('Abandonne', ftBoolean, 0, False);
      Add('Debit_Deb', ftCurrency, 0, False);
      Add('Credit_Deb', ftCurrency, 0, False);
      Add('Adresse1', ftString, 100, False);
      Add('Adresse2', ftString, 100, False);
      Add('Poste', ftString, 5, False);
      Add('Ville', ftString, 25, False);
      Add('Pays', ftString, 20, False);
      Add('Livr_Adr1', ftString, 100, False);
      Add('Livr_Adr2', ftString, 100, False);
      Add('Livr_Poste', ftString, 5, False);
      Add('Livr_Ville', ftString, 25, False);
      Add('Livr_Pays', ftString, 20, False);
      Add('Telephone1', ftString, 15, False);
      Add('Telephone2', ftString, 15, False);
      Add('Telecopie', ftString, 15, False);
      Add('Mel', ftString, 30, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('Actif', ftBoolean, 0, False);
      Add('ID_GESTCO', ftFloat, 0, False);
      Add('ID_COMMUNICATION', ftFloat, 0, False);
      Add('CODE_GESTCO', ftString, 50, False);
      Add('ID_Affichage', ftInteger, 0, False);
      Add('JBanque', ftString, 15, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Tiers', [ixPrimary, ixUnique]);
      Add('Nom_', 'Nom', [ixCaseInsensitive]);
      Add('Compte_', 'Compte;Tiers', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 15, WantAbort);
    If WantAbort then Goto TABLEno15;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Tiers.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 15, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 15, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Trame.DB }
    TABLEno15b:
    TABLEno15: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Trame.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno16b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Code', ftString, 10, False);
      Add('Libelle_Trame', ftString, 100, False);
      Add('Libelle', ftString, 100, False);
      Add('Journal', ftString, 2, False);
      Add('Compte', ftString, 8, False);
      Add('Compte_Reglement', ftString, 8, False);
      Add('Minimun', ftBoolean, 0, False);
      Add('ID_Devise', ftInteger, 0, False);
      Add('ID_Journal', ftInteger, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Libelle_', 'Libelle_Trame', [ixCaseInsensitive]);
      Add('Code_', 'Code', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 16, WantAbort);
    If WantAbort then Goto TABLEno16;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Trame.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 16, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 16, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> TrameL.DB }
    TABLEno16b:
    TABLEno16: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'TrameL.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno17b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Trame', ftInteger, 0, False);
      Add('Ligne', ftSmallInt, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Qt1', ftFloat, 0, False);
      Add('Qt2', ftFloat, 0, False);
      Add('MontantDebit', ftCurrency, 0, False);
      Add('MontantCredit', ftCurrency, 0, False);
      Add('TvaCode', ftString, 2, False);
      Add('TvaType', ftString, 1, False);
      Add('TvaTaux', ftFloat, 0, False);
      Add('MontantTva', ftCurrency, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('TypeLigne', ftString, 1, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('_num_ligne', 'ID_Trame;Ligne', [ixCaseInsensitive]);
      Add('_ID_Trame', 'ID_Trame', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 17, WantAbort);
    If WantAbort then Goto TABLEno17;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: TrameL.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False; 
    AfterCreateCB(Table, 17, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False; 
    ProgressCB(Table, 17, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> TvaCode.DB }
    TABLEno17b:
    TABLEno17: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'TvaCode.DB';
    // is table already existing ? 
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno18b;
    with FieldDefs do
    begin
      Clear;
      Add('TvaCode', ftString, 2, False);
      Add('Classe', ftString, 1, False);
      Add('Libelle', ftString, 100, False);
      Add('Compte', ftString, 8, False);
      Add('Taux_Inf', ftFloat, 0, False);
      Add('Taux_Supp', ftFloat, 0, False);
      Add('Qui', ftString, 10, False);
      Add('Quand', ftDateTime, 0, False);
      Add('CODE_GESTCO', ftString, 50, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'TvaCode', [ixPrimary, ixUnique]);
      Add('Compte_', 'Compte', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 18, WantAbort);
    If WantAbort then Goto TABLEno18;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: TvaCode.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 18, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 18, WantAbort);
    If WantAbort then Goto LBLEND;



    { Creating : DBALIAS0 --> Cdp.DB }
    TABLEno18b:
    TABLEno18: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Cdp.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno19b;
    with FieldDefs do
    begin
      Clear;
      Add('Id', ftInteger, 0, False);
      Add('Cdp', ftString, 50, False);
      Add('LibelleCdp', ftString, 100, False);
      Add('Unite', ftString, 2, False);
      Add('LibelleUnite', ftString, 50, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id', [ixPrimary, ixUnique]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 19, WantAbort);
    If WantAbort then Goto TABLEno19;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Cdp.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 19, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 19, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> CompteA.DB }
    TABLEno19b:
    TABLEno19: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'CompteA.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno20b;
    with FieldDefs do
    begin
      Clear;
      Add('Id', ftInteger, 0, False);
      Add('IDCdpPere', ftInteger, 0, False);
      Add('CompteA', ftString, 50, False);
      Add('LibelleA', ftString, 100, False);
      Add('Ratio', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id', [ixPrimary, ixUnique]);
      Add('_IDCdpPere', 'IDCdpPere', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 20, WantAbort);
    If WantAbort then Goto TABLEno20;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: CompteA.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 20, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 20, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> Cpt_CptA.DB }
    TABLEno20b:
    TABLEno20: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Cpt_CptA.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno21b;
    with FieldDefs do
    begin
      Clear;
      Add('Id', ftInteger, 0, False);
      Add('IDCompteA', ftInteger, 0, False);
      Add('IDCdpPere', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('CompteA', ftString, 50, False);
      Add('Ratio', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id', [ixPrimary, ixUnique]);
      Add('_Compte', 'Compte', [ixCaseInsensitive]);
      Add('_IdCdpPere', 'IDCdpPere', [ixCaseInsensitive]);
      Add('_IDCompteA', 'IDCompteA', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 21, WantAbort);
    If WantAbort then Goto TABLEno21;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Cpt_CptA.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 21, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 21, WantAbort);
    If WantAbort then Goto LBLEND;




    { Creating : DBALIAS0 --> CptAB_Cdp.DB }
    TABLEno21b:
    TABLEno21: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'CptAB_Cdp.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno22b;
    with FieldDefs do
    begin
      Clear;
      Add('Id', ftInteger, 0, False);
      Add('IDCdp', ftInteger, 0, False);
      Add('IDFils', ftInteger, 0, False);
      Add('Cdp', ftString, 50, False);
      Add('Fils', ftString, 50, False);
      Add('Ratio', ftFloat, 0, False);
      Add('TypeFils', ftSmallInt, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id', [ixPrimary, ixUnique]);
      Add('_IDFils', 'IDFils', [ixCaseInsensitive]);
      Add('_IDCdp', 'IDCdp', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 22, WantAbort);
    If WantAbort then Goto TABLEno22;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: CptAB_Cdp.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 22, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 22, WantAbort);
    If WantAbort then Goto LBLEND;


        { Creating : DBALIAS0 --> Emprunts.DB }
    TABLEno22b:
    TABLEno22: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Emprunts.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table

    if TblExists then
     begin
       try
          active:=false;

          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' select * from emprunts ');
          Query.open;

          if (query.FindField('differeMois')<>nil) then
            if (query.FindField('differeMois').DataType = ftfloat) then
              begin
                  if (query.FindField('conteneur')=nil) then
                  begin
                    Query.Close;
                    Query.SQL.Clear;
                    Query.SQL.Add(' Alter table emprunts add conteneur integer');
                    Query.ExecSQL;
                  end;

                  //mettre ce qu'il y a dans differemois dans conteneur
                  Query.Close;
                  Query.SQL.Clear;
                  Query.SQL.Add(' update emprunts set conteneur=differeMois');
                  Query.ExecSQL;
                  //supprimer differeMois
                  Query.Close;
                  Query.SQL.Clear;
                  Query.SQL.Add(' Alter table emprunts drop differeMois');
                  Query.ExecSQL;
                  //recréer differeMois
                  Query.Close;
                  Query.SQL.Clear;
                  Query.SQL.Add(' Alter table emprunts add differeMois integer');
                  Query.ExecSQL;
                  //mettre ce qu'il y a dans conteneur dans differemois
                  Query.Close;
                  Query.SQL.Clear;
                  Query.SQL.Add(' update emprunts set differeMois=conteneur');
                  Query.ExecSQL;
                  //supprimer conteneur
                  Query.Close;
                  Query.SQL.Clear;
                  Query.SQL.Add(' Alter table emprunts drop conteneur');
                  Query.ExecSQL;
              end;

          if query.FindField('differeMois')=nil then
            begin
                Query.Close;
                Query.SQL.Clear;
                Query.SQL.Add(' Alter table emprunts add differeMois integer ');
                Query.ExecSQL;
            end;
       except
       end;
                Query.Close;
                Query.SQL.Clear;
                Query.SQL.Add(' update emprunts set differeMois = (differe*12) where differemois is null and not differe is null ');
                Query.ExecSQL;
     end;

    active:=false;
    if TblExists then goto TABLEno23b; 
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Code_Emp', ftString, 20, False);
      Add('Compte_Emp', ftString, 8, False);
      Add('Designation_Emp', ftString, 100, False);
      Add('CapiResteDu_Emp', ftCurrency, 0, False);
      Add('CapiTotal_Emp', ftCurrency, 0, False);
      Add('CodeGr', ftString, 3, False);
      Add('DateRealisation', ftDate, 0, False);
      Add('NbPeriode', ftFloat, 0, False);
      Add('P1', ftFloat, 0, False);
      Add('PP1', ftFloat, 0, False);
      Add('P2', ftFloat, 0, False);
      Add('PP2', ftFloat, 0, False);
      Add('P3', ftFloat, 0, False);
      Add('PP3', ftFloat, 0, False);
      Add('TypeRb', ftString, 3, False);
      Add('PeriodeRb', ftString, 3, False);
      Add('Differe', ftFloat, 0, False);
      Add('DiffereMois', ftInteger, 0, False);
      Add('FraisAnnexe', ftFloat, 0, False);
      Add('Assurance', ftFloat, 0, False);
      Add('DatePremEcheance', ftDate, 0, False);
      Add('CapitalRbPE', ftCurrency, 0, False);
      Add('InteretRbPE', ftCurrency, 0, False);
      Add('NbRbFait', ftFloat, 0, False);
      Add('Banque', ftString, 30, False);
      Add('Actif', ftBoolean, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID;Code_Emp;Compte_Emp', [ixPrimary, ixUnique]);
      Add('Code', 'Code_Emp', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 23, WantAbort);
    If WantAbort then Goto TABLEno23;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Emprunts.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 23, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 23, WantAbort);
    If WantAbort then Goto LBLEND;


    { Creating : DBALIAS0 --> LCpt_CptA.DB }
    TABLEno23b:
    TABLEno23: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'LCpt_CptA.DB';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno24b;
    with FieldDefs do
    begin
      Clear;
      Add('Id', ftInteger, 0, False);
      Add('IDCompteA', ftInteger, 0, False);
      Add('IDCdpPere', ftInteger, 0, False);
      Add('IDLigne', ftInteger, 0, False);
      Add('CompteA', ftString, 50, False);
      Add('Ratio', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'Id', [ixPrimary, ixUnique]);
      Add('_IDLigne', 'IDLigne', [ixCaseInsensitive]);
      Add('_IDCdpPere', 'IDCdpPere', [ixCaseInsensitive]);
      Add('_IDCompteA', 'IDCompteA', [ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 24, WantAbort);
    If WantAbort then Goto TABLEno24;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: LCpt_CptA.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 24, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 24, WantAbort);
    If WantAbort then Goto LBLEND;


    
    { Creating : DBALIAS0 --> TA_Activite.db }
    TABLEno24b:
    TABLEno24: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'TA_Activite.db';
    // is table already existing ?

    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno25b;
    with FieldDefs do
    begin
      Clear;
      Add('ID_Activite', ftInteger, 0, False);
      Add('Code_Activite', ftString, 50, False);
      Add('Libelle_Activite', ftString, 100, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID_Activite', [ixPrimary, ixUnique]);
    end; { IndexDefs }

//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 25, WantAbort);
    If WantAbort then Goto TABLEno25;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: TA_Activite.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 25, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 25, WantAbort);
    If WantAbort then Goto LBLEND;

    { Creating : DBALIAS0 --> TA_Affect_Atelier.DB }
    TABLEno25b:
    TABLEno25: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'TA_Affect_Atelier.DB';
    // is table already existing ?
    with FieldDefs do Clear;                           //indexAffectationCompte','Code_atelier'
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
//    if TblExists then
//     begin
//       try
//          IndexDefs.Clear;   //IndexEcriture', 'compte;id'
//          active:=false;
////
//          Query.Close;
//          Query.SQL.Clear;
//          Query.SQL.Add(' CREATE ASC INDEX indexAffectation ');
//          Query.SQL.Add(' ON "TA_Affect_Atelier.db" (Code_atelier)');
//          Query.ExecSQL;
//
//          IndexDefs.Update;
//       except
//       end;
//     end;
    active:=false;
    if TblExists then goto TABLEno26b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftAutoInc, 0, False);
      Add('ID_Atelier', ftInteger, 0, False);
      Add('ID_Ligne', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Code_Atelier', ftString, 50, False);
      Add('Ratio', ftFloat, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
//      add('','ID',[ixPrimary, ixUnique]);
//      add('indexAffectation','Code_atelier',[]);
    end; { IndexDefs }

//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 26, WantAbort);
    If WantAbort then Goto TABLEno26;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: TA_Affect_Atelier.DB'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 26, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 26, WantAbort);
    If WantAbort then Goto LBLEND;



    { Creating : DBALIAS0 --> TA_Atelier.db }

    TABLEno26b:
    TABLEno26: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'TA_Atelier.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno27b;
    with FieldDefs do
    begin
      Clear;
      Add('ID_Atelier', ftInteger, 0, False);
      Add('Code_Atelier', ftString, 50, False);
      Add('Libelle_Atelier', ftString, 100, False);
      Add('NB_Unite_Atelier', ftFloat, 0, False);
      Add('Unite_Atelier', ftString, 10, False);
      Add('ID_Activite', ftInteger, 0, False);
      Add('Code_Activite', ftString, 50, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID_Atelier', [ixPrimary, ixUnique]);
    end; { IndexDefs }

//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 27, WantAbort);
    If WantAbort then Goto TABLEno27;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: TA_Atelier.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 27, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 27, WantAbort);
    If WantAbort then Goto LBLEND;

    { Creating : DBALIAS0 --> H_Tva_Fin.db }

    TABLEno27b:
    TABLEno27: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'H_Tva_Fin.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno28;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Id_Declaration', ftInteger, 0, False);
      Add('TypeSolde', ftSmallInt, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Total', ftCurrency, 0, False);
      Add('SensCredit', ftSmallInt, 0, False);
      Add('ATraiter', ftBoolean, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID;Id_Declaration', [ixPrimary, ixUnique]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 28, WantAbort);
    If WantAbort then Goto TABLEno28;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: H_Tva_Fin.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 28, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 28, WantAbort);
    If WantAbort then Goto LBLEND;

    { Creating : DBALIAS0 --> H_Tva_Report.db }

    TABLEno28b:
    TABLEno28: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'H_Tva_Report.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno29b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Id_Declaration', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Solde', ftCurrency, 0, False);
      Add('SensCredit', ftBoolean, 0, False);
      Add('ATraiter', ftBoolean, 0, False);
      Add('Code_Choix', ftSmallInt, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID;Id_Declaration', [ixPrimary, ixUnique]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 29, WantAbort);
    If WantAbort then Goto TABLEno29;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: H_Tva_Report.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 29, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 29, WantAbort);
    If WantAbort then Goto LBLEND;

    { Creating : DBALIAS0 --> H_PieceTva.db }

    TABLEno29b:
    TABLEno29: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'H_PieceTva.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno30b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Declaration', ftInteger, 0, False);
      Add('Reference_OD', ftString, 9, False);
      Add('Debut_Periode', ftDatetime, 0, False);
      Add('Fin_Periode', ftDatetime, 0, False);
      Add('Verrouillee', ftBoolean, 0, False);
      Add('Deverrouillable', ftBoolean, 0, False);
      Add('VerrouillageManuel', ftBoolean, 0, False);
      Add('Divers_Bool', ftBoolean, 0, False);
      Add('Divers_Str', ftString, 255, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID;Id_Declaration', [ixPrimary, ixUnique]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 30, WantAbort);
    If WantAbort then Goto TABLEno30;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: H_PieceTva.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 30, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 30, WantAbort);
    If WantAbort then Goto LBLEND;


    { Creating : DBALIAS0 --> AtelierDefaut.db }

    TABLEno30b:
    TABLEno30: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'AtelierDefaut.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno31b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('Code_Atelier', ftString, 50, False);
      Add('libelle_Atelier', ftString, 100, False);
      Add('Cpt_Plan', ftString, 8, False);
      Add('Cpt_Racine', ftString, 8, False);
      Add('Code_Activite', ftString, 50, False);
      Add('Divers', ftString, 255, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Code_CptPlan', 'Code_Atelier;Cpt_Plan', [ixCaseInsensitive]);
      Add('Code_Racine', 'Code_Atelier;Cpt_Racine', [ixCaseInsensitive]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 31, WantAbort);
    If WantAbort then Goto TABLEno31;

//    if (E.TypeClient = CL_Cogere)or(E.TypeClient = CL_saisie_Cogere) then
     begin
      Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: AtelierDefaut.db'); End;
      try
       TableCreatePassWord(DBALIAS0,TableName,'lepelet');
      except
      end;
     end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 31, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 31, WantAbort);
    If WantAbort then Goto LBLEND;


    { Creating : DBALIAS0 --> GDossier.db }
    TABLEno31b:
    TABLEno31: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'GDossier.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then
     begin
       try
          IndexDefs.Clear;
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' drop index GDossier.Date_Util');
          Query.ExecSQL;
          IndexDefs.Update;
       except
       end;
      try
          IndexDefs.Clear;
          active:=false;
          Query.Close;
          Query.SQL.Clear;
          Query.SQL.Add(' CREATE INDEX Date_Util ');
          Query.SQL.Add(' ON "GDossier.db" (DateUtil,ID_Dossier)');
          Query.ExecSQL;
          IndexDefs.Update;
       except
       end;
     end;
    if TblExists then goto TABLEno32b;
    with FieldDefs do
    begin
      Clear;
      Add('ID_Dossier', ftInteger, 0, False);
      Add('ID_Table', ftInteger, 0, False);
      Add('Nom_Dossier', ftString, 255, False);
      Add('Dir_Dossier', ftString, 255, False);
      Add('Nom_Exo', ftString, 255, False);
      Add('Dir_Exo', ftString, 255, False);
      Add('Annee_Dossier', ftDateTime, 0, False);
      Add('DateUtil', ftDateTime, 0, False);
      Add('Cloture', ftBoolean, 0, False);
      Add('EXO_BASE', ftString, 2, False);
      Add('EXO_SAISIE', ftString, 2, False);
      Add('DATE_DEB_EXO', ftDate, 0, False);
      Add('DATE_FIN_EXO', ftDate, 0, False);
      Add('DESIGNATION_DOSSIER', ftString, 100, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID_Dossier;ID_Table', [ixPrimary, ixUnique]);
      Add('Date_Util', 'DateUtil;ID_Dossier', [ixDescending, ixCaseInsensitive]);
      Add('IdDosExo', 'ID_Dossier;ID_Table', [ixUnique, ixCaseInsensitive]);
    end; { IndexDefs }
//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 32, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: GDossier.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;

//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 32, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 32, WantAbort);
    If WantAbort then Goto LBLEND;

    { Creating : DBALIAS0 --> Piece_Import.db }

    TABLEno32b:
    TABLEno32: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Piece_Import.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno33b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('ID_Piece_Import', ftInteger, 0, False);
      Add('Nouvel_ID_Piece', ftInteger, 0, False);
      Add('Compte', ftString, 8, False);
      Add('Libelle', ftString, 100, False);
      Add('Debit', ftCurrency, 0, False);
      Add('Credit', ftCurrency, 0, False);
      Add('ID_Prog', ftInteger, 0, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('Piece_', 'ID_Piece_Import;ID_Prog', [ixCaseInsensitive]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 33, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Piece_Import.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 33, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 33, WantAbort);
    If WantAbort then Goto LBLEND;


        { Creating : DBALIAS0 --> ComptesBancaire.db }

    TABLEno33b:
    TABLEno33: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'ComptesBancaire.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
      begin
      try
        if FieldDefs.IndexOf('code_banque') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='code_banque';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=5;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('code_guichet') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='code_guichet';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=5;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('compte_banque') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='compte_banque';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=11;
            AddField(table,ChangeRec );
           end;
         except
         end;

        try
        if FieldDefs.IndexOf('login') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='login';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=100;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('password') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='password';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=100;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('iban') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='iban';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=100;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('codeBic') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='codeBic';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=20;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('site') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='site';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=255;
            AddField(table,ChangeRec );
           end;
         except
         end;

//        try
//        if IndexDefs.IndexOf('designation_') = -1 then
//           begin
//            active:=false;
//            Exclusive:=true;
//            open;
//            AddIndex('designation_','designation',[ixCaseInsensitive] );
//           end;
//         except
//         end;
        try
        if IndexDefs.IndexOf('ibanBic_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('ibanBic_','iban;codeBic',[ixCaseInsensitive] );
           end;
         except
         end;
        try
        if IndexDefs.IndexOf('login_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('login_','login;password',[ixCaseInsensitive] );
           end;
         except
         end;
        try
        if IndexDefs.IndexOf('logCodeBancaire_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('logCodeBancaire_','codeBancaire;login;password',[ixCaseInsensitive] );
           end;
         except
         end;
      end;
    active:=false;
    active:=false;
    if TblExists then goto TABLEno34b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('journal', ftString, 10, true);
      Add('codeBancaire', ftString, 100, true);
      Add('login', ftString, 100, False);
      Add('password', ftString, 100, False);
      Add('iban', ftString, 100, False);
      Add('codeBic', ftString, 20, False);
      Add('site', ftString, 255, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('ibanBic_','iban;codeBic',[ixCaseInsensitive] );
      Add('login_','login;password',[ixCaseInsensitive] );
      Add('logCodeBancaire_','codeBancaire;login;password',[ixCaseInsensitive] );

    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 34, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: ComptesBancaire.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 34, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 34, WantAbort);
    If WantAbort then Goto LBLEND;



    { Creating : DBALIAS0 --> Ta_ReleveBancaire.db }

    TABLEno34b:
    TABLEno34: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Ta_ReleveBancaire.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    if TblExists then
      begin
        try
        if FieldDefs.IndexOf('code_banque') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='code_banque';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=5;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try 
        if FieldDefs.IndexOf('code_guichet') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='code_guichet';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=5;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('compte_banque') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='compte_banque';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=11;
            AddField(table,ChangeRec );
           end;
         except
         end;
         try
        if FieldDefs.IndexOf('Rapprochement') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='Rapprochement';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=8;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('Marque') <> -1 then
           begin
            active:=false;
            ChangeFieldLength(DataBaseName,TableName,'Marque',13,8);
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('id_Ecriture') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='id_Ecriture';
            ChangeRec.iType:=fldINT32;
            ChangeRec.iLength:=0;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('cptTiers') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='cptTiers';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=8;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if FieldDefs.IndexOf('Abandon') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='Abandon';
            ChangeRec.iType:=fldBOOL;
            ChangeRec.iLength:=0;
            AddField(table,ChangeRec );
           end;
         except
         end;
        try
        if IndexDefs.IndexOf('designation_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('designation_','designation',[ixCaseInsensitive] );
           end;
         except
         end;
        try
        if IndexDefs.IndexOf('cptTiers_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('cptTiers_','cptTiers',[ixCaseInsensitive] );
           end;
         except
         end;
        try
        if IndexDefs.IndexOf('compteBanque_') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            AddIndex('compteBanque_','code_banque;code_guichet;compte_banque',[ixCaseInsensitive] );
           end;
         except
         end;
      end;
    active:=false;
    if TblExists then goto TABLEno35b ;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('compte', ftString, 8, False);
      Add('dateOp', ftDate, 0, False);
      Add('Debit', ftCurrency, 0, False);
      Add('Credit', ftCurrency, 0, False);
      Add('designation', ftString, 100, False);
      Add('supplement', ftString, 100, False);
      Add('marque', ftString, 8, False);
      Add('Reference', ftString, 50, False);
      Add('divers', ftString, 255, False);
      Add('rapprochement', ftString, 8, False);
      Add('code_banque', ftString, 5, False);
      Add('code_guichet', ftString, 5, False);
      Add('compte_banque', ftString, 11, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
      Add('compte', 'compte', [ixCaseInsensitive]);
      Add('compteDate', 'compte;DateOp', [ixCaseInsensitive]);
      Add('compteMontant', 'compte;Debit;Credit', [ixCaseInsensitive]);
      Add('compteBanque_', 'code_banque;code_guichet;compte_banque', [ixCaseInsensitive]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 35, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Ta_ReleveBancaire.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 35, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 35, WantAbort);
    If WantAbort then Goto LBLEND;


//
    { Creating : DBALIAS0 --> Ta_Verifs.db }

    TABLEno35b:
    TABLEno35: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Ta_Verifs.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno36b ;
    with FieldDefs do
    begin
      Clear;
      Add('exercice', ftString, 50, False);
      Add('module', ftString, 50, False);
      Add('valeur', ftString, 100, False);
      Add('continuer', ftBoolean, 0, true);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'exercice;module', [ixPrimary, ixUnique]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 36, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Ta_Verifs.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 36, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 36, WantAbort);
    If WantAbort then Goto LBLEND;


//
    { Creating : DBALIAS0 --> Ta_releve_ebics.db }

    TABLEno36b:
    TABLEno36: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Ta_releve_ebics.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno37b ;
    with FieldDefs do
    begin
      Clear;

      Add('id', ftInteger, 0, true);
      Add('idEnteteServeur', ftInteger, 0, True);
      Add('idMouvServeur', ftInteger, 0, True);
      Add('code_enreg', ftString, 2, true);
      Add('code_banque', ftString, 5, true);
      Add('code_op_interne', ftString, 4, False);
      Add('code_guichet', ftString, 5, true);
      Add('devise', ftString, 3, false);
      Add('nb_decimal', ftFloat, 0, false);
      Add('zoneReserve1', ftString,1, false);
      Add('compte_banque', ftString, 11, true);
      Add('code_op_bancaire', ftString, 2, False);
      Add('date_compta', ftDate, 0, true);
      Add('rejet', ftString, 2, False);
      Add('date_valeur', ftDate, 0, true);
      Add('libelle', ftString, 31, true);
      Add('zoneReserve2', ftString,2, false);
      Add('num_ecriture', ftInteger, 0, false);
      Add('exoneration', ftString, 1, False);
      Add('indisponibilite', ftString, 1, False);
      Add('montant', ftCurrency, 0, true);
      Add('reference', ftString, 16, true);
      Add('traite', ftBoolean, 0, False);

    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'id', [ixPrimary, ixUnique]);
      Add('rib', 'code_banque;code_guichet;compte_banque', [ixCaseInsensitive]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 37, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Ta_releve_ebics.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 37, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 37, WantAbort);
    If WantAbort then Goto LBLEND;
//


//
    { Creating : DBALIAS0 --> Ta_complement_ebics.db }

    TABLEno37b:
    TABLEno37: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'Ta_complement_ebics.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if TblExists then goto TABLEno38b ;
    with FieldDefs do
    begin
      Clear;

      Add('id', ftInteger, 0, True);
      Add('idEnteteServeur', ftInteger, 0, True);
      Add('idMouvServeur', ftInteger, 0, True);
      Add('idComplServeur', ftInteger, 0, True);
      Add('id_mouv', ftInteger, 0, True);
      Add('code_enreg', ftString, 2, true);
      Add('code_banque', ftString, 5, true);
      Add('code_op_interne', ftString, 4, False);
      Add('code_guichet', ftString, 5, true);
      Add('devise', ftString, 3, False);
      Add('nb_decimal', ftFloat, 0, False);
      Add('zoneReserve1', ftString,1, False);
      Add('compte_banque', ftString, 11, true);
      Add('code_op_bancaire', ftString, 2, False);
      Add('date_compta', ftDate, 0, true);
      Add('zoneReserve2', ftString,5, false);
      Add('type_compl', ftString, 3, True);
      Add('complement', ftString, 70, false);
      Add('zoneReserve3', ftString,2, false);


    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'id', [ixPrimary, ixUnique]);
      Add('LigneMouv', 'id;id_mouv', [ixCaseInsensitive]);
      Add('rib', 'code_banque;code_guichet;compte_banque', [ixCaseInsensitive]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 38, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: Ta_complement_ebics.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 38, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 38, WantAbort);
    If WantAbort then Goto LBLEND;
//



    { Creating : DBALIAS0 --> InfosJuridiques.db }

    TABLEno38b:
    TABLEno38: // for internal jump
    DataBaseName := DBALIAS0;
    TableName := 'InfosJuridiques.db';
    // is table already existing ?
    with FieldDefs do Clear;
    TblExists:=False;
    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
    active:=false;
    if(TblExists)then
    begin
      try
        if FieldDefs.IndexOf('DEVISE') = -1 then
           begin
            active:=false;
            Exclusive:=true;
            open;
            ChangeRec.szName:='DEVISE';
            ChangeRec.iType:=fldZSTRING;
            ChangeRec.iLength:=3;
            AddField(table,ChangeRec );
           end;
         except
         end;
    end;

    if TblExists then goto TABLEno39b;
    with FieldDefs do
    begin
      Clear;
      Add('ID', ftInteger, 0, False);
      Add('siret', ftString, 50, False);
      Add('tva_intra', ftString, 50, False);
      Add('DEVISE', ftString, 3, False);
    end; { FieldDefs }
    with IndexDefs do
    begin
      Clear;
      Add('', 'ID', [ixPrimary, ixUnique]);
    end; { IndexDefs }


//  Before create event
    WantAbort := False;
    BeforeCreateCB(Table, 39, WantAbort);
    If WantAbort then Goto LBLEND;

    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: InfosJuridiques.db'); End;
    try
     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
    except
    end;


//  After create event
    WantAbort := False;
    AfterCreateCB(Table, 39, WantAbort);
    If WantAbort then Goto LBLEND;

//  Progress event
    WantAbort := False;
    ProgressCB(Table, 39, WantAbort);
    If WantAbort then Goto LBLEND;


    { Creating : DBALIAS0 --> autorisation.DB }

    TABLEno39b:
    TABLEno39: // for internal jump
//    DataBaseName := DBALIAS0;
//    TableName := 'autorisation.DB';
//    // is table already existing ?
//    with FieldDefs do Clear;
//    TblExists:=False;
//    try Open; TblExists:=true; except TblExists:=FileExists(IncludeTrailingPathDelimiter(DBALIAS0)+TableName) end; // exists. skip this table
//    active:=false;
////    if(TblExists)then
////    begin
////      try
////        if FieldDefs.IndexOf('DEVISE') = -1 then
////           begin
////            active:=false;
////            Exclusive:=true;
////            open;
////            ChangeRec.szName:='DEVISE';
////            ChangeRec.iType:=fldZSTRING;
////            ChangeRec.iLength:=3;
////            AddField(table,ChangeRec );
////           end;
////         except
////         end;
////    end;
//
//    if TblExists then goto LBLENDb;
//    with FieldDefs do
//    begin
//      Clear;
//      Add('id_autorisation', ftInteger, 0, False);
//      Add('fichier', ftMemo, 0, False);
//      Add('date_der_synchro', ftDateTime, 0, False);
//      Add('quand_cree', ftDateTime, 0, False);
//      Add('quand_modif', ftDateTime, 0, False);
//      Add('qui_cree', ftString, 50, False);
//      Add('qui_modif', ftString, 50, False);
//    end; { FieldDefs }
//    with IndexDefs do
//    begin
//      Clear;
//      Add('', 'id_autorisation', [ixPrimary, ixUnique]);
//    end; { IndexDefs }
//
//
////  Before create event
//    WantAbort := False;
//    BeforeCreateCB(Table, 40, WantAbort);
//    If WantAbort then Goto LBLEND;
//
//    Try If not TblExists then CreateTable; Except ShowMessage('Impossible de créer la table: autorisation.db'); End;
//    try
//     TableCreatePassWord(DBALIAS0,TableName,'lepelet');
//    except
//    end;
//
//
////  After create event
//    WantAbort := False;
//    AfterCreateCB(Table, 40, WantAbort);
//    If WantAbort then Goto LBLEND;
//
////  Progress event
//    WantAbort := False;
//    ProgressCB(Table, 40, WantAbort);
//    If WantAbort then Goto LBLEND;


  TABLEno40b:

  end; { table }
//  if(creationUtilisateur)or(ForceCreation)then
//  begin
//      Query.Close;
//      Query.DatabaseName:=DBALIAS0;
//      Query.SQL.Clear;
//      Query.SQL.Add('update Param_dossier set CREATION = '''+typeUtilisateurtoStr(e.TypeUtilisateur)+''',');
//      Query.SQL.Add('FORCE=''faux''');
//      Query.ExecSQL;
//      Query.close;
//  end;
  LBLENDb:
  LBLEND:
  Finally
   Query.Close;
   Query.Free;
  table.Free;
  end;
Finally Screen.Cursor:=crDefault; end;
end;



procedure UpdateTables(DBALIAS0 : String);
var
  Requete: TQuery;
begin
Screen.Cursor := crHourGlass;
Try
  Requete := TQuery.Create(Application);

  Try

    Requete.DataBaseName := DBALIAS0;
    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''F'' where type is null and substring(compte from 1 for 2)=''40''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''C'' where type is null and substring(compte from 1 for 2)=''41''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''P'' where type is null and substring(compte from 1 for 2)=''42''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''O'' where type is null and substring(compte from 1 for 2)=''43''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''A'' where type is null and substring(compte from 1 for 2)=''45''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''D'' where type is null and substring(compte from 1 for 2)=''46''');
    Requete.ExecSQL;


    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''E'' where type is null and substring(compte from 1 for 2)=''44''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  Tiers.db set Type=''T'' where type is null and substring(compte from 1 for 1)=''4''');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  ta_releveBancaire.db set Marque=null where Marque <>'''' and (Rapprochement is null or rapprochement='''')');
    Requete.ExecSQL;

    Requete.sql.clear;
    Requete.sql.Add('update  ecriture.db set MarqueReleve=null where MarqueReleve <>'''' and (Rapprochement is null or rapprochement='''')');
    Requete.ExecSQL;
  except
  end;
Finally
Screen.Cursor:=crDefault;
Requete.Close;
Requete.Free;
end;
end;


INITIALIZATION
BeforeCreateCB := DummyCallBack;
AfterCreateCB  := DummyCallBack;
ProgressCB     := DummyCallBack;

end.
